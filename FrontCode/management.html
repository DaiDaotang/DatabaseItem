<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="layui/css/layui.css"  media="all">
  <style type = "text/css">
	.form-select-self1 {
		width:455px!important;
	}
	.form-select-self2 {
		width:298px!important;
	}
	.form-select-self3 {
		padding-top:15px!important;
	}
    .form-select-self4 {
        padding-top: 45px !important;
    }
	.table-self1 {
		margin-right: 10px!important;
	}
	.table-self2 {
		margin-left: 10px!important;
		margin-right: 10px!important;
	}	
	.table-self1 {
		margin-left: 10px!important;
	}
	.button-self {
		margin:10px;
	}
    .switch_self {
        width: 180px!important;
    }
    .signup_self {
        width: 325px!important;
        height: 400px!important;
    }
    .icon-self {
        margin-top: 0px !important;
    }
    .table_signed_self{
        margin-left: 600px!important;
    }
  </style>
</head>
<body>
    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li class="layui-this">赛程安排</li>
            <li>裁判录入</li>
            <li>注册队伍</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>赛程安排</legend>
                </fieldset>
                <form class="layui-form layui-form-pane" action="" id="Arrangement">
                    <div class="layui-form-item">
                        <label class="layui-form-label">项目</label>
                        <div class="layui-input-inline">
                            <select name="gender_select" lay-filter="select_gender">
                                <option value="">请选择性别</option>
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <select name="item_select" id="select_item" lay-filter="item_select"></select>
                        </div>
                        <div class="layui-input-inline">
                            <select name="age_select" id="select_age" lay-filter="select_age">
                                <option value="7-8">7-8岁</option>
                                <option value="9-10">9-10岁</option>
                                <option value="11-12">11-12岁</option>
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <button class="layui-btn" lay-submit="" lay-filter="find_btn"><i class="layui-icon layui-icon-search"></i></button>
                        </div>
                    </div>
                </form>
                <div>
                    <div class="layui-form-item">
                        <div class="layui-input-inline form-select-self1">
                            <table class="layui-hide" id="id_name_item_kid" lay-filter="id_name_item_kid"></table>
                        </div>
                        <div class="layui-input-inline form-select-self2">
                            <table class="layui-hide" id="groupnumber_judge" lay-filter="groupnumber_judge"></table>
                        </div>
                        <div class="layui-inline layui-input-inline form-select-self3">
                            <input type="text" class="layui-input" id="date_pk" lay-filter="date_pk">
                            <div class=" form-select-self4 layui-input-inline" id="time_pk" lay-filter="time_pk"></div>
                        </div>
                        <div class="layui-input-inline">
                            <table class="layui-hide" id="arranged_group" lay-filter="arranged_group"></table>
                        </div>
                    </div>
                    <center>
                        <button class="layui-btn button-self" lay-submit="" lay-filter="add_btn"><i class="layui-icon layui-icon-add-1"></i></button>
                    </center>
                </div>
            </div>
            <div class="layui-tab-item">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>裁判录入</legend>
                </fieldset>
                <form class="layui-form layui-form-pane" action="" id="Sign_up_judge">
                    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                        <legend>裁判组长</legend>
                    </fieldset>
                    <div class="layui-form-item layui-input-inline layui-inline">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-inline">
                            <input type="text" name="judge_master_name" autocomplete="off" lay-verify="required" placeholder="请输入姓名" class="layui-input" id="judge_master_name" lay-filter="judge_master_name">
                        </div>
                    </div>
                    <div class="layui-form-item layui-input-inline layuis-inline">
                        <label class="layui-form-label">身份证</label>
                        <div class="layui-input-inline">
                            <input type="text" name="judge_master_idcard" autocomplete="off" lay-verify="required" placeholder="请输入身份证号" class="layui-input" id="judge_master_idcard" lay-filter="judge_master_idcard">
                        </div>
                    </div>
                    <div class="layui-form-item layui-input-inline layui-inline">
                        <label class="layui-form-label">电话</label>
                        <div class="layui-input-inline">
                            <input type="text" name="judge_master_tel" autocomplete="off" lay-verify="required" placeholder="请输入电话号" class="layui-input" id="judge_master_tel" lay-filter="judge_master_tel">
                        </div>
                    </div>
                    <div class="layui-form-item layui-input-inline layui-inline">
                        <label class="layui-form-label">账号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="judge_master_account" autocomplete="off" lay-verify="required" placeholder="请输入电话号" class="layui-input" id="judge_master_account" lay-filter="judge_master_account">
                        </div>
                    </div>

                    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                        <legend>裁判组员</legend>
                    </fieldset>

                </form>
            </div>
            <div class="layui-tab-item">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>注册队伍</legend>
                </fieldset>
                <div>
                    <form class="layui-form layui-form-pane signup_self layui-input-inline" action="" id="Sign_up_team">
                        <div class="layui-form-item">
                            <label class="layui-form-label">队伍名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="team_name" lay-verify="required" placeholder="请输入队伍名称" autocomplete="off" class="layui-input" id="team_name" lay-filter="team_name">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">队伍账号</label>
                            <div class="layui-input-inline">
                                <input type="text" name="team_account" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input" id="team_account" lay-filter="team_account">
                            </div>
                        </div>
                        <div class="layui-form-item switch_self" pane="">
                            <label class="layui-form-label">东道主</label>
                            <div class="layui-input-block">
                                <input type="checkbox" name="team_host" lay-skin="switch" lay-text="Yes|No" id="team_host" lay-filter="team_host">
                            </div>
                        </div>
                        <center>
                            <button class="layui-btn button-self" lay-submit="" lay-filter="signup_btn"><i class="layui-icon layui-icon-upload"></i></button>
                        </center>
                    </form>
                    <div class="layui-input-inline table_signed_self">
                        <table class="layui-hide" id="signed_up_team" lay-filter="signed_up_team"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="layui/layui.js" charset="utf-8"></script>
    <script src="jquery-3.3.1.min.js" charset="utf-8"></script>
    <script type="text/html" id="toolbar_kid">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中数据</button>
            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        </div>
    </script>
    <script type="text/html" id="toolbar_judge">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中数据</button>
        </div>
    </script>
    <script>    
        /////////////////////////////////////////////////////////////////////reqId                          //改
        var id_management = "123";
        /////////////////////////////////////////////////////////////////////赛事安排
        var minTime = "2017-1-11"
            , maxTime = "2017-12-31";
        var data_kid = []
            , data_kid_name = []
            , data_judge = ""
            , data_date = ""
            , data_time = "13:00"
            , data_arrangement = []
            , result = [
                ""                     //  itemName    
                , ""                   //  sex         
                , "7-8"                //  ageDelivery 
                , []                   //  list
            ];
        var param_kid = function(res){return {
            elem: '#id_name_item_kid'
            , id: 'table_sportkids'
            , url: 'http://localhost:8080/GetAthleteList'
            , title: '运动员列表'
            , toolbar: '#toolbar_kid'
            , contentType: 'application/json'
            , width: 455
            , height: 425
            , method: "POST"
            , deal: function (res) {
                return {
                    code: 0, msg: "", count: 1000, data: res.resData
                }
            }
            , where: {
                "reqId": id_management,
                "reqParam": {
                    "itemName": res[0]
                    , "age": res[2]
                    , "sex": res[1]
                }
            }
            , cols: [[
                { type: 'checkbox' }
                , { field: 'ath_id', width: 75, title: 'ID', unresize: true, sort: true }
                , { field: 'ath_name', width: 130, title: '名称' }
                , { field: 'team_name', width: 180, title: '代表队' }
            ]]
        }}
            , param_judge = function(res){return {
                elem: '#groupnumber_judge'
                , url: 'http://localhost:8080/GetRefGroup'
                , method: "POST" //以后所有的请求都用POST
                , where: {
                    "reqId": id_management
                }
                , contentType: 'application/json'//必加
                , title: '裁判组列表'
                , toolbar: '#toolbar_judge'
                , width: 298
                , deal: function (res) {
                    return { code: 0, msg: "", count: 1000, data: res.resData }
                }//用于处理接口返回数据，使之与layui要求一样，主要是将返回数据中的list赋值给data
                , cols: [[
                    { type: 'radio' }
                    , { field: 'ref_group_id', width: 70, title: 'ID', unresize: true, sort: true }
                    , { field: 'ref_master', width: 175, title: '裁判长' }
                ]]
            };}
            , param_arranged = function(res){return {
                elem: '#arranged_group'
                , url: 'http://localhost:8080/CheckSchedule'
                , title: '已安排列表'
                , width: 540
                , height: 425
                , toolbar: true
                , method: "POST"
                , contentType: 'application/json'
		            , deal: function (res) {
		                    return { code: 0, msg: "", count: 1000, data: res.resData }
		                }
                , where: {
                    "reqId": id_management
                    , "reqPageInfo": {
                        "pageSize": 1000
                        , "curPage": 1
                    }
                    , "reqParam": {
                        "itemName": res[0]
                        , "age": res[2]
                        , "sex": res[1]
                    }
                }
                , cols: [[
                    { field: 'com_id', width: 185, title: '组号', sort: true }
                    , { field: 'amount', width: 65, title: '人数' }
                    , { field: 'ref_group_id', width: 80, title: '裁判组' }
                    , { field: 'time', width: 205, title: '时间' }
                ]]
            }};
        var param_kid_0 = {
            elem: '#id_name_item_kid'
            , url: 'http://localhost:8080/GetAthleteList'
            , title: '运动员列表'
            , toolbar: '#toolbar_kid'
            , contentType: 'application/json'
            , method: "POST"
            , width: 455
            , height: 425
            , where: { "reqId": id_management }
            , deal: function (res) {
                return { code: 0, msg: "", count: 1000, data: res.resData }
            }
            , cols: [[
                { type: 'checkbox' }
                , { field: 'ath_id', width: 75, title: 'ID', unresize: true, sort: true }
                , { field: 'ath_name', width: 130, title: '名称' }
                , { field: 'team_name', width: 180, title: '代表队' }
            ]]
        } 
            , param_arranged_0 = {
                elem: '#arranged_group'
                , url: 'http://localhost:8080/CheckSchedule'
                , title: '已安排列表'
                , width: 540
                , height: 425
                , toolbar: true
                , method: "POST"
                , contentType: 'application/json'
		            , deal: function (res) {
		                    return { code: 0, msg: "", count: 1000, data: res.resData }
		                }
                , where: {
                    "reqId": id_management
                    , "reqPageInfo": {
                        "pageSize": 0
                        , "curPage": 1
                    }
                    , "reqParam": {
                        "itemName": ""
                        , "age": ""
                        , "sex": ""
                    }
                }
                , cols: [[
                    { field: 'com_id', width: 85, title: '组号', sort: true }
                    , { field: 'amount', width: 65, title: '人数' }
                    , { field: 'ref_group_id', width: 80, title: '裁判组' }
                    , { field: 'time', width: 305, title: '时间' }
                ]]
            };

        //form区
        layui.use(['form', 'layedit', 'laydate', 'table', 'jquery'], function () {
            var form = layui.form
                , layer = layui.layer
                , layedit = layui.layedit
                , laydate = layui.laydate
                , table = layui.table
                , $ = layui.$;

            //创建一个编辑器
            var editIndex = layedit.build('LAY_demo_editor');

            //监听查询
            form.on('submit(find_btn)', function (data) {
                console.log(result);
                table.render(param_kid(result));
                table.render(param_judge(result));
                table.render(param_arranged(result));
                return false;
            });

            //监听添加按钮
            form.on('submit(add_btn)', function (obj) {
                if (data_judge != "" && data_kid.length != 0 && data_date != "") {
                    var data_temp = [
                        data_kid                        //ath_list
                        , data_judge                    //judge_group
                        , data_date + " " + data_time   //time
                    ]
                    result[3].push(data_temp);

                    console.log(result);
                    var that = this;
                    $.ajax({
                        type: "POST"
                        , url: "http://localhost:8080/ArrangeSchedule"
                        , async: true
                        , data: JSON.stringify({
                            "reqId": id_management
                            , "reqParam": {
                                "itemName": result[0]
                                , "sex": result[1]
                                , "ageDelivery": result[2]
                                , "group_lists": [
                                    {
                                        "ath_lists": result[3][0][0]
                                        , "time": result[3][0][2]
                                        , "ref_group": result[3][0][1]
                                    }
                                ]
                            }
                        })
                        , dataType: "json"
                        , success: function (res) {
                            console.log(res)
                            console.log(that.result)
                            data_kid = [];
                            data_judge = "";
                            table.render(param_kid(result));
                            table.render(param_judge(result));
                            table.render(param_arranged(result));
                        },
                        error: function (err) {
                            console.log(err);
                        }
                    })
                }
                else {
                    if (data_judge == "")
                        layer.alert('裁判选择有误')
                    else if (data_kid.length == 0)
                        layer.alert('未选择运动员')
                    else
                        layer.alert('请重新选择日期')
                }
            });

            //改变单选框内容
            form.on('select(select_gender)', function (data) {
                console.log(data.value); //得到被选中的值
                if (data.value == '男') {
                    result[0] = "单杠";
                    document.getElementById('select_item').innerHTML = "<option value='单杠'>单杠</option><option value='双杠'>双杠</option><option value='吊环'>吊环</option><option value='跳马'>跳马</option><option value='自由体操'>自由体操</option><option value='鞍马'>鞍马</option><option value='蹦床'>蹦床</option>"
                    form.render('select');
                } else if (data.value == '女') {
                    result[0] = "跳马";
                    document.getElementById('select_item').innerHTML = "<option value='跳马'>跳马</option><option value='高低杠'>高低杠</option><option value='平衡木'>平衡木</option><option value='自由体操'>自由体操</option><option value='蹦床'>蹦床</option>"
                    form.render('select');
                }
                result[1] = data.value;
                result[3] = [];
            });
            form.on('select(item_select)', function (data) {
                result[0] = data.value;
                console.log(data.value);
                console.log(result[0]);
            });
            form.on('select(select_age)', function (data) {
                result[2] = data.value;
            });

            //表单初始赋值
            form.val('Arrangement', {
                "select_gender": ""
                , "select_item": ""
                , "select_age": "7-8"
            })

            //选择时间
            laydate.render({
                elem: '#date_pk'
                , done: function (value, date, endDate) {
                    data_date = value;
                }
            });
        });

        //元素
        layui.use('element', function () {
            var $ = layui.jquery
                , element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
        });

        //表格
        layui.use('table', function () {
            var table = layui.table;

            //选择运动员
            table.render(param_kid_0);
            table.on('toolbar(id_name_item_kid)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                console.log(checkStatus)
                switch (obj.event) {
                    case 'getCheckData':
                        var data = checkStatus.data;
                        var num = 0;
                        var contents = new Array(data.length);
                        while (num < data.length) {
                            contents[num] = data[num].id
                            console.log(data[num].id)
                            num++;
                        }
                        console.log("共" + num + "人")
                        console.log(contents)
                        layer.alert(JSON.stringify(contents), {
                            title: '选中运动员'
                        });
                        break;
                    case 'getCheckLength':
                        var data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                        break;
                };
            });
            table.on('checkbox(id_name_item_kid)', function (res) {
                if (res.checked) {
                    //console.log(res.data.id)
                    data_kid.push({ "ath_id": res.data.ath_id, "ath_name": res.data.ath_name });
                }
                else {
                    for (let temp in data_kid) {
                        if (data_kid[temp] == res.data.id) {
                            if (data_kid.length == 1)
                                data_kid = [];
                            else 
                                data_kid.splice(temp, temp);
                            break;
                        }
                    }
                }
                //console.log(data_kid);
            });

            //选择裁判
            table.render(param_judge(result));
            table.on('toolbar(groupnumber_judge)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                var data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            });
            table.on('radio(groupnumber_judge)', function (res) {
                data_judge = res.data.ref_group_id;
                //console.log(data_judge);
            });

            //展示已有小组
            table.render(param_arranged_0);
        });

        //滑条
        layui.use('slider', function () {
            var slider = layui.slider;

            //渲染
            slider.render({
                elem: '#time_pk'
                , min: 16
                , max: 36
                , value: 26
                , setTips: function (value) { 
                    if (value % 2 == 0)
                        return value / 2 + ':00';
                    else
                        return (value - 1) / 2 + ':30';
                }
                , change: function (value) {
                    var temp1 = value % 2 == 0? value / 2 + ':00' : (value - 1) / 2 + ':30';
                    data_time = temp1;
                    console.log(data_time)
                }
            });
        });

        ////////////////////////////////////////////////////////////////////裁判录入            //修改请求
        //form区                            //增加请求
        layui.use('form', function () {
            var form = layui.form;
            var result_judge = [
                ""
                , ""
                , ""
                , ""
                , []
            ]
                , temp = []
                , temp_name = "";

            for (var i = 0; i < 4; i++) {
                document.getElementById("Sign_up_judge").innerHTML += '<div><div class="layui-form-item layui-input-inline layui-inline"><label class="layui-form-label">姓名</label ><div class="layui-input-inline"><input type="text" id="judge_name_' + i + '" lay-filter="judge_name_' + i + '" name="judge_name_' + i + '" autocomplete="off" placeholder="请输入姓名" class="layui-input"></div></div><div class="layui-form-item layui-input-inline layuis-inline"><label class="layui-form-label">身份证</label><div class="layui-input-inline"><input type="text" id="judge_idcard_' + i + '" lay-filter="judge_idcard_' + i + '" name="judge_idcard_' + i + '" autocomplete="off" placeholder="请输入身份证号" class="layui-input"></div></div><div class="layui-form-item layui-input-inline layui-inline"><label class="layui-form-label">电话</label><div class="layui-input-inline"><input type="text" id="judge_tel_' + i + '" lay-filter="judge_tel_' + i + '" name="judge_tel_' + i + '" autocomplete="off" placeholder="请输入电话号" class="layui-input"></div></div><div class="layui-form-item layui-input-inline layui-inline"><label class="layui-form-label">账号</label ><div class="layui-input-inline"><input type="text" id="judge_account_' + i + '" lay-filter="judge_account_' + i + '" name="judge_account_' + i + '" autocomplete="off" placeholder="请输入账号" class="layui-input"></div></div></div>'
            }
            document.getElementById("Sign_up_judge").innerHTML += '<center><button class="layui-btn" lay-submit="" lay-filter="sign_up_judge_btn"><i class="layui-icon layui-icon-upload"></i></button></center>'

            form.on("submit(sign_up_judge_btn)", function (data) {
                console.log(data.field);
                result_judge[0] = data.field.judge_master_name;
                result_judge[1] = data.field.judge_master_idcard;
                result_judge[2] = data.field.judge_master_tel;
                result_judge[3] = data.field.judge_master_account;
                for (var i = 0; i < 4; i++) {
                    if (data.field[temp_name] == "")
                        break;
                    temp_name = "judge_name_" + i;
                    temp.push(document.getElementById(temp_name).value);
                    temp_name = "judge_idcard_" + i;
                    temp.push(document.getElementById(temp_name).value);
                    temp_name = "judge_tel_" + i;
                    temp.push(document.getElementById(temp_name).value);
                    temp_name = "judge_account_" + i;
                    temp.push(document.getElementById(temp_name).value);
                    result_judge[4].push(temp);
                    temp = [];
                }

                layer.msg('注册成功！');
                console.log(result_judge);
                document.getElementById("Sign_up_judge").reset();
                return false;
            })
        });        

        /////////////////////////////////////////////////////////////////////队伍注册
        var param_signed_up_team = {
            elem: '#signed_up_team'
            , url: ''
            , method: "POST"
            , where: { "reqId": id_management }
            , contentType: 'application/json'//必加
            , title: '已注册队伍列表'
            , width: 300
            , height: 400
            , deal: function (res) {
                return { code: 0, msg: "", count: 1000, data: res.resData }
            }//用于处理接口返回数据，使之与layui要求一样，主要是将返回数据中的list赋值给data
            , cols: [[
                { field: 'team_id', width: 100, title: 'ID', unresize: true, sort: true }
                , { field: 'team_name', width: 200, title: '队伍名称' }
            ]]
        }        //修改url
        //form table区                       //修改请求
        layui.use(['form','table'], function () {
            var form = layui.form
                , layer = layui.layer
                , table = layui.table;

            var signup_result = [];
            var team_is_host = false;

            //监听开关
            form.on('switch(team_host)', function (data) {
                if (data.elem.checked)
                    team_is_host = true;
            });
            //监听提交按钮
            form.on('submit(signup_btn)', function (data) {
                signup_result.push(data.field.team_name);
                signup_result.push(data.field.team_account);
                signup_result.push(team_is_host);

                console.log(signup_result);
                layer.msg('注册成功！');

                team_is_host = false;
                signup_result = [];
                document.getElementById("Sign_up_team").reset();
                table.render(param_signed_up_team);

                return false;
            });
            //表格刷新
            table.render(param_signed_up_team);
        })
    </script>

</body>
</html>