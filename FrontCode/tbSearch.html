<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>赛事查询</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="layui/css/layui.css"  media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style type="text/css">
        .div-self {
            width: 650px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li class="layui-this">赛事查询</li>
            <li>运动员查询</li>
            <li>团队查询</li>
            <li>运动员排名</li>
            <li id="team_only">队内信息</li>
            <li id="judge1_only">小组裁判</li>
            <li id="judge2_only">小组裁判长</li>
            <li id="judge3_only">小组总裁判</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>赛事查询</legend>
                </fieldset>
                <div style="width: 100%; position: relative;left:11%;">
                    <form class="layui-form layui-form-pane" action="" id="searchForm">
                        <div class="layui-form-item">
                            <div class="layui-input-inline">
                                <select name="gender_select" lay-filter="select_gender">
                                    <option value="">请选择性别</option>
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                            <label class="layui-form-label">项目</label>
                            <div class="layui-input-inline">
                                <select name="item_select" id="select_item" lay-filter="select_item"></select>
                            </div>
                            <div class="layui-input-inline">
                                <select name="age_select" id="select_age" lay-filter="select_age">
                                    <option value="7-8">7-8岁</option>
                                    <option value="9-10">9-10岁</option>
                                    <option value="11-12">11-12岁</option>
                                </select>
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn" lay-submit="" lay-filter="find_btn"><i class="layui-icon layui-icon-search"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
                <div style="text-align: center;">
                    <div class="layui-input-inline">
                        <table class="layui-hide" id="gameType" lay-filter="gameType"></table>
                    </div>
                    <div class="layui-input-inline">
                        <table class="layui-hide" name="playerDetails" id="playerDetails" lay-filter="playerDetails"></table>
                    </div>
                </div>
            </div>


            <div class="layui-tab-item">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>运动员查询</legend>
                </fieldset>
                <div style="width: 100%; position: relative;left:11%;">
                    <form class="layui-form layui-form-pane" action="" id="searchForm">
                        <div class="layui-form-item">
                            <label class="layui-form-label">运动员</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="athlete_input" id="athlete_input"></input>
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn" lay-submit="" lay-filter="find_btn_ath"><i class="layui-icon layui-icon-search"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
                <div style="text-align: center;">
                    <div class="layui-input-inline">
                        <table class="layui-hide" name="playerDetails_pname" id="playerDetails_pname" lay-filter="playerDetails_pname"></table>
                    </div>
                </div>
            </div>


            <div class="layui-tab-item">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>代表队查询</legend>
                </fieldset>
                <div style="width: 100%; position: relative;left:11%;">
                    <form class="layui-form layui-form-pane" action="" id="searchForm">
                        <div class="layui-form-item">
                            <label class="layui-form-label">代表队名</label>
                            <div class="layui-input-inline">
                                <input class="layui-input" name="team_input" id="team_input"></input>
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn" lay-submit="" lay-filter="find_btn_team"><i class="layui-icon layui-icon-search"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
                <div style="text-align: center;">
                    <div class="layui-input-inline">
                        <table class="layui-hide" id="team" lay-filter="team"></table>
                    </div>
                </div>
            </div>


            <div class="layui-tab-item">
                <div style="width: 750px; margin: 50px auto;">
                    <table class="layui-hide" id="ath_grade_all" lay-filter="ath_grade_all"></table>
                </div>
            </div>

			<div class="layui-tab-item">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>队内信息</legend>
                </fieldset>
                <div class="div-self" style="width: 700px;">
                    <table class="layui-hide div-self " id="team_info_self" lay-filter="team_info_self"></table>
                </div>
            </div>


			<div class="layui-tab-item">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
					<legend>小组裁判评分</legend>
				</fieldset>
		
				<div style="text-align: center;">
					<div class="layui-input-inline">
						<table class="layui-hide" id="gameType1" lay-filter="gameType1"></table>
					</div>
					<div class="layui-input-inline">
						<table class="layui-hide" id="scoring1" lay-filter="scoring1"></table>
					</div>
				</div>
				<center>
				<div class="layui-input-inline">
					<button class="layui-btn" lay-submit="" lay-filter="return_btn">完成</button>
				</div>
				</center>
			</div>	


			<div class="layui-tab-item">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
					<legend>裁判长</legend>
				</fieldset>
				<div style="text-align: center;">
					<div class="layui-input-inline">
						<table class="layui-hide" id="gameType2" lay-filter="gameType2"></table>
					</div>
					<div class="layui-input-inline">
						<table class="layui-hide" id="final_scoring" lay-filter="final_scoring"></table>
					</div>
				</div>
		
				<div style="text-align: center;">       
					<button class="layui-btn" id="finished_btn" lay-filter="finished_btn">完成</button>
				</div>  
			</div>		
           
			<div class="layui-tab-item">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
					<legend>小组总裁判</legend>
				</fieldset>
				<div style="text-align: center;">
					<div class="layui-input-inline">
						<table class="layui-hide" id="gameType3" lay-filter="gameType3"></table>
					</div>
					<div class="layui-input-inline">
						<table class="layui-hide" id="final_scoring3" lay-filter="final_scoring3"></table>
					</div>
				</div>
		
				<div style="text-align: center;">
					<button class="layui-btn" lay-submit="" name="failed_btn" id="failed_btn" lay-filter="failed_btn">未通过</button>        
					<button class="layui-btn" lay-submit="" name="passed_btn" id="passed_btn" data-type="passed_btn">通过</button>
				</div>  
			</div>		
		    
        </div>
		
		
		
		
		
        <div id="team_only_change_password">
            <button class="layui-btn" lay-submit="" lay-filter="change_password_btn" id="change_password_btn" name="change_password_btn" style="position:absolute; top: 8px; right: 10px;"><i class="layui-icon layui-icon-password"></i></button>
        </div>
    </div>	
    <script id="barDemo1" type="text/html">
		<a class="layui-btn layui-btn-xs" lay-event="submit_oneScore">提交</a>	
	</script>
	<script id="barDemo2" type="text/html">
		<a class="layui-btn layui-btn-xs" lay-event="pass">通过</a>
		<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="turnBack">打回</a>
	</script>
	<script src="layui/layui.js" charset="utf-8"></script>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 --> 
 
	<script>
		//权限显示	
        if (window.localStorage.authority == "游客") {
            document.getElementById('team_only').style.display = 'none';
            document.getElementById('team_only_change_password').style.display = 'none';
        } 
		
		if(window.localStorage.authority != "代表队") {
			document.getElementById('team_only').style.display = 'none';
		}
		
		if(window.localStorage.authority != "裁判") {
			document.getElementById('judge1_only').style.display = 'none';
		}
		
		if(window.localStorage.authority != "总裁判") {
			document.getElementById('judge2_only').style.display = 'none';
		}
		
		if(window.localStorage.authority != "裁判长") {
			document.getElementById('judge3_only').style.display = 'none';
		}

		var result = [
			""    //itemName 0
			,""   //sex		1
			,"7-8"//age		2
			,[]		//athlete list 
			,""   //com_id	4
			,""   //ath_name	5
			,""   //team_name	6
			,""   //ath_id		7
			,""   //score		8
		];
		
		//查询部分//////////////////////////////////////////////////////////////////////////////////////////////////////////
		var param_gameType = function(res){return{
			elem: '#gameType'
			,id:'table_gameType'
			,url:'http://localhost:8080/CheckSchedule'
			,title:'组别表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData
				}
			}
			,where:{
				"reqId":"",
				"reqParam":{
					"itemName":res[0],
					"age":res[2],
					"sex":res[1]
                },
                "reqPageInfo": {
                    "pageSize":1000
                }
			}
			,cols: [[
				{type:'radio'}
				,{field:'com_id', width:120, title: '组号'}
				,{field:'ref_group_id', width:80, title: '裁判组'}
				,{field:'time', width:200, title: '时间'}
				,{field:'amount', width:120, title: '人数'}
			]]
			,page: false
		}};

  
		var param_playerDetails = function(res){return{
			elem: '#playerDetails'
			,id:'table_playerDetails'
			,url:'http://localhost:8080/GetResultByItem'
			,title:'运动员列表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData.list
				}
			}
			,where:{
				"reqId":"",
				"reqParam":{
					"itemName":res[0],
					"ageDelivery":res[2],
					"sex":res[1],
					"com_id":res[4]
					//组号
                },
                "reqPageInfo": {
                    "pageSize": 1000
                }
			}
			,cols: [[
				
				{field:'ath_id', width:120, title: '运动员编号'}
				,{field:'ath_name', width:120, title: '运动员'}
				,{field:'team_name', width:120, title: '队伍'}
				,{field:'type', width:120, title: '类型'}
				,{field:'rank', width:80, title: '排名', sort: true}
				,{field:'result', width:120, title: '成绩', sort: true}
			]]
			,page: false
		}};
		
		var param_playerDetails_pname = function(res){return{
			elem: '#playerDetails_pname'
			,id:'table_playerDetails_pname'
			,url:'http://localhost:8080/GetResultByAthlete'
			,title:'运动员列表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData.list
				}
			}
			,where:{
				"reqId":"",
				"reqParam":{
					"ath_name":res[5]
                },
                "reqPageInfo": {
                    "pageSize": 1000
                }
			}
			,cols: [[
				{field:'ath_id', width:120, title: '运动员编号'}
				,{field:'ath_name', width:120, title: '运动员'}
				,{field:'team_name', width:120, title: '队伍'}
				,{field:'item_name', width:150, title: '比赛'}
				,{field:'type', width:120, title: '类型'}
				,{field:'rank', width:80, title: '排名'}
				,{field:'result', width:120, title: '成绩'}
			]]
			,page: false
		}};
		
		var param_team = function(res){return{
			elem: '#team'
			,id:'team'
			,url:'http://localhost:8080/GetResultByTeam'
			,title:'队伍列表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData.list
				}
			}
			,where:{
				"reqId":"",
				"reqParam":{
					"team_name":res[6]
                },
                "reqPageInfo": {
                    "pageSize": 1000
                }
			}
			,cols: [[
				{field:'team_name', width:120, title: '队伍'}		
				,{field:'ath_id', width:120, title: '运动员编号'}
				,{field:'ath_name', width:120, title: '运动员'}
				,{field:'item_name', width:120, title: '项目'}
				,{field:'type', width:80, title: '类型'}
				,{field:'rank', width:120, title: '排名'}
				,{field:'result', width:120, title: '成绩'}
				//,{field:'team_rank', width:120, title: '代表队名次'}
			]]
			,page: false
		}};
        
		
		 //元素
		layui.use('element', function () {
			var $ = layui.jquery
				, element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
		});		
		
		//form区
        layui.use(['form', 'table'],  function () {
            var form = layui.form
                , layer = layui.layer
                , table = layui.table
                , $ = layui.$;

           
			
			
            //监听项目查询
            form.on('submit(find_btn)', function (data) {
				result[3] = [];
				console.log(result);
				table.render(param_gameType(result));
				table.render(param_playerDetails(result));
                window.event.returnValue = false;

				return false;
            });
			
			//监听运动员查询
            form.on('submit(find_btn_ath)', function (data) {
				result[3] = [];
				console.log(data.field.athlete_input);
				result[5]=data.field.athlete_input;
				console.log(result);
				table.render(param_playerDetails_pname(result));
                window.event.returnValue = false;
				return false;
            });
			
			//监听运动员查询
            form.on('submit(find_btn_team)', function (data) {
				result[3] = [];
				console.log(data.field.team_input);
				result[6]=data.field.team_input;
				console.log(result);
				table.render(param_team(result));
                window.event.returnValue = false;
				return false;
            });
			
			//改变单选框内容
            form.on('select(select_gender)', function (data) {
                console.log(data.value); //得到被选中的值
				result[1]=data.value;
                if (data.value == '男') {
					result[0]="单杠";
                    document.getElementById('select_item').innerHTML = "<option value='单杠'>单杠</option><option value='双杠'>双杠</option><option value='吊环'>吊环</option><option value='跳马'>跳马</option><option value='自由体操'>自由体操</option><option value='鞍马'>鞍马</option><option value='蹦床'>蹦床</option>"
                    form.render('select');
                } else if (data.value == '女') {
					result[0]="跳马";
                    document.getElementById('select_item').innerHTML = "<option value='跳马'>跳马</option><option value='高低杠'>高低杠</option><option value='平衡木'>平衡木</option><option value='自由体操'>自由体操</option><option value='蹦床'>蹦床</option>"
                    form.render('select');
                }
                
            });
			
			//获得下拉查询条件
			form.on('select(select_item)', function (data) {
                result[0] = data.value;
                console.log(data.value);
                console.log(result[0]);
            });
			
            form.on('select(select_age)', function (data) {
                result[2] = data.value;
				console.log(result[2]);
            });
			
			//表单初始赋值
            form.val('searchForm', {
                "select_gender": ""
                , "select_item": ""
                , "select_age": "7-8"
            });
			
			//获取radio行的数据
			table.on("radio(gameType)",function(data){
				console.log(data.data)
				result[4] = data.data.com_id;
				table.render(param_playerDetails(result));
				
			});
            
		});
		/////////////////////////////////////////////////////////////////////////////////////////////////

        //队内信息//////////////////////////////////////////////////////////////////////////////////////
        layui.use('table', function (res) {
            var table = layui.table;
            var team_id = window.localStorage.id
                , team_name = window.localStorage.name;
            var param_team_member_info = {
                elem: '#team_info_self'
                , url: 'http://localhost:8080/GetPersonInfo'
                , method: 'POST'
                , where: {
                    'reqId': team_id
                }
                , contentType: 'application/json'
                , title: '对内信息'
                , toolbar: true
                , width: 707
            , deal: function (res) {
                    return {
                        code: 0
                        , msg: ""
                        , count: 1000
                        , data: res.resData
                    }
                }
                , cols: [[
                    { field: 'position', width: 100, title: '职务' }
                    , { field: 'name', width: 150, title: '名字' }
                    , { field: 'sex', width: 100, title: '性别 ' }
                    , { field: 'tel', width: 150, title: '电话号' }
                    , { field: 'id_card', width: 200, title: '身份证' }
                ]]
            }

            table.render(param_team_member_info);
        });

        //修改密码///////////////////////////////////////////////////////////////////
        layui.use('layer', function () {
            var $ = layui.jquery
                , layer = layui.layer;
            $(document).on('click', '#change_password_btn', function () {
                var strUrl = window.location.href;
                var arrUrl = strUrl.split("/");
                var strPage = arrUrl[arrUrl.length - 1];
                window.localStorage.temp_web_url = strPage;
                window.window.location.href = "./change_password.html";
            });
        });
		////////////////////////////////////////////////////////////////////////////////

        

		//小组裁判/////////////////////////////////////////////////////////////////////////
		
		var param_gameType1 = function(res){return{
				elem: '#gameType1'
				,id:'table_gameType1'
				,url:'http://localhost:8080/GetCompetition'
				,title:'组别表'
				,contentType:'application/json'
				,method:"POST"
				,deal:function(res){
					return{
						code:0,msg:"",count:1000,data:res.resData
					}
				}
				,where:{
					"reqId":window.localStorage.id,
					"reqParam":{
						"authority":window.localStorage.authority
					}
				}
				,cols: [[
					{type:'radio'}
					,{field:'com_id', width:200, title: '比赛小组'}
					,{field:'sex', width:80, title: '性别'}
					,{field:'age', width:80, title: '年龄'}
					,{field:'item_name', width:80, title: '比赛'}
				]]
				,page: false
			}
		};
	
		var param_scoring1 = function(res){return{
				elem: '#scoring1'
				,id:'table_scoring1'
				,url:'http://localhost:8080/GetScores1'
				,title:'运动员列表'
				,contentType:'application/json'
				,method:"POST"
				,deal:function(res){
					return{
						code:0,msg:"",count:1000,data:res.resData
					}
				}
				,where:{
					"reqId":window.localStorage.id,
					"reqParam":{
						"com_id":res[4]
						//组号
					}
				}
				,cols: [[
					{field:'ath_id', width:120, title: '运动员编号'}
					,{field:'ath_name', width:120, title: '运动员'}
					,{field:'scores', width:120, title: '成绩', edit: 'text'}
					,{fixed: 'right', title:'操作', toolbar: '#barDemo1', width:80}
				]]
					,page: false
			}
		};

	
	
		layui.use(['table','jquery'], function(){
			var table = layui.table
				,layer = layui.layer
                , form = layui.form
                , $ = layui.$;
		
			//init the table
			table.render(param_gameType1(result));
			table.render(param_scoring1(result));
	  
			//监听单元格编辑
			table.on('edit(scoring1)', function(obj){
				var value = obj.value //得到修改后的值
				,data = obj.data //得到所在行所有键值
				,field = obj.field; //得到字段
			});
			
			//获取radio行的数据
			table.on("radio(gameType1)",function(data){
				console.log(data.data)
				result[4] = data.data.com_id;
				console.log(result[4]);
				table.render(param_scoring1(result));
					
			});
			
			//监听行工具事件
			table.on('tool(scoring1)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
				var data = obj.data //获得当前行数据
				,layEvent = obj.event; //获得 lay-event 对应的值
				console.log(data);
				if(layEvent == 'submit_oneScore'){
					//ajax代码
					
					$.ajax({
						type: "POST"
						, url: "http://localhost:8080/GiveMark"
						, async: true
						, data: JSON.stringify({
							"reqId": window.localStorage.id
							,"reqParam": {
								"ath_id": data.ath_id
								,"com_id": result[4]
								,"score": parseFloat(data.scores)
							}
						})
						, dataType: "json"
						, success: function (res) {
							
						}
						,error: function (err) {
							console.log(this.data);
							console.log(err);
						}
					});
					
					layer.msg('已提交');
				};
			});
		
		});
		
		//////////////////////////////////////////////////////////////////////////////
		
		
		//小组总裁判//////////////////////////////////////////////////////////////////
		var param_gameType2 = function(res){return{
			elem: '#gameType2'
			,id:'table_gameType2'
			,url:'http://localhost:8080/GetCompetition'
			,title:'组别表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData
				}
			}
			,where:{
				"reqId":window.localStorage.id
				,"reqParam":{
					"authority":window.localStorage.authority
				}
			}
			,cols: [[
				{type:'radio'}
				,{field:'com_id', width:80, title: '裁判组'}
				,{field:'sex', width:120, title: '性别'}
				,{field:'age', width:120, title: '年龄'}
				,{field:'item_name', width:120, title: '比赛'}
			]]
			,page: false
		}};
	
		var param_scoring2 = function(res){return{
			elem: '#final_scoring'
			,id:'table_scoring2'
			,url:'http://localhost:8080/GetScores2'
			,title:'组别表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				var scoreList = [{

				}];
				scoreList.splice(0, 1);
				for (var i = 0; i < res.resData.length; i++) {
					scoreList.push({
						ath_id: res.resData[i].ath_id,
						ath_name: res.resData[i].ath_name,
						com_id: res.resData[i].com_id,
						team_name: res.resData[i].team_name,
						D: res.resData[i].D,
						P: res.resData[i].P,
						judge1: res.resData[i].scores[0].score,
						judge2: res.resData[i].scores[1].score,
						judge3: res.resData[i].scores[2].score,
						judge4: res.resData[i].scores[3].score
					})
				}
				return{
					code: 0, msg: "", count: 1000, data: scoreList
					
				}	
			}
			,where:{
				"reqId":window.localStorage.id
				,"reqParam":{
					"com_id":res[4]
				}
			}
			,cols: [[
				{field:'ath_id', width:120, title: '运动员编号'}
				,{field:'ath_name', width:120, title: '运动员'}
				,{field:'judge1',width:70,title:'裁判1'}
				,{field:'judge2',width:70,title:'裁判2'}
				,{field:'judge3',width:70,title:'裁判3'}
				,{field:'judge4',width:70,title:'裁判4'}
				,{field:'D',width:60,title:'D',edit:'text'}
				,{field:'P',width:60,title:'P',edit:'text'}
				,{fixed: 'right', title:'操作', toolbar: '#barDemo2', width:120}
			]]
			,page: false
		}};
		
	
		layui.use(['table','jquery'], function(){
			var table = layui.table
				,layer = layui.layer
                , form = layui.form
                , $ = layui.$;
	  
			table.render(param_gameType2(result));
			table.render(param_scoring2(result));
			
			//获取radio行的数据
			table.on("radio(gameType2)",function(data){
				console.log(data.data)
				result[4] = data.data.com_id;
				console.log(result[4]);
				table.render(param_scoring2(result));
					
			});
			
			//监听单元格编辑
			table.on('edit(final_scoring)', function(obj){
				var value = obj.value //得到修改后的值
				,data = obj.data //得到所在行所有键值
				,field = obj.field; //得到字段
				layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
			});
			
			//监听行工具事件
			table.on('tool(final_scoring)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
				var data = obj.data //获得当前行数据
				,layEvent = obj.event; //获得 lay-event 对应的值
				console.log(data);
				if(layEvent == 'pass'){
					//ajax代码
					
					$.ajax({
						type: "POST"
						, url: "http://localhost:8080/GiveDP"
						, async: true
						, data: JSON.stringify({
							"reqId": window.localStorage.id
							,"reqParam": {
								"ath_id": data.ath_id
								,"com_id": result[4]
								,"D": parseFloat(data.D)
								,"P":parseFloat(data.P)
								,"pass":true
							}
						})
						, dataType: "json"
						, success: function (res) {
                            layer.msg('已提交');
						}
						,error: function (err) {
							console.log(this.data);
							console.log(err);
						}
					});
					
					
                } else if (layEvent == 'turnBack') {

                    $.ajax({
                        type: "POST"
                        , url: "http://localhost:8080/GiveDP"
                        , async: true
                        , data: JSON.stringify({
                            "reqId": window.localStorage.id
                            , "reqParam": {
                                "ath_id": data.ath_id
                                , "com_id": result[4]
                                , "D": parseFloat(data.D)
                                , "P": parseFloat(data.P)
                                , "pass": false
                            }
                        })
                        , dataType: "json"
                        , success: function (res) {
                            layer.msg("打回重新打分");
                        }
                        , error: function (err) {
                            console.log(this.data);
                            console.log(err);
                        }
                    });

					
				};
			});
			
	  
		});
		
		/////////////////////////////////////////////////////////////////////////////////////////////
		
		//小组裁判长/////////////////////////////////////////////////////////////////////////////////
		var param_gameType3 = function(res){return{
			elem: '#gameType3'
			,id:'table_gameType3'
			,url:'http://localhost:8080/GetCompetition'
			,title:'组别表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				return{
					code:0,msg:"",count:1000,data:res.resData
				}
			}
			,where:{
				"reqId":window.localStorage.id
				,"reqParam":{
					"authority":window.localStorage.authority
				}
			}
			,cols: [[
				{type:'radio'}
				,{field:'com_id', width:80, title: '裁判组'}
				,{field:'sex', width:120, title: '性别'}
				,{field:'age', width:120, title: '年龄'}
				,{field:'item_name', width:120, title: '比赛'}
			]]
			,page: false
		}};
	
		var param_scoring3 = function(res){return{
			elem: '#final_scoring3'
			,id:'table_scoring3'
			,url:'http://localhost:8080/GetScores3'
			,title:'组别表'
			,contentType:'application/json'
			,method:"POST"
			,deal:function(res){
				var scoreList = [{

				}];
				scoreList.splice(0, 1);
				for (var i = 0; i < res.resData.length; i++) {
					scoreList.push({
						ath_id: res.resData[i].ath_id,
						ath_name: res.resData[i].ath_name,
						com_id: res.resData[i].com_id,
						team_name: res.resData[i].team_name,
						D: res.resData[i].D,
						P: res.resData[i].P,
						judge1: res.resData[i].scores[0].score,
						judge2: res.resData[i].scores[1].score,
						judge3: res.resData[i].scores[2].score,
						judge4: res.resData[i].scores[3].score
					})
				}
				return{
					code: 0, msg: "", count: 1000, data: scoreList
					
				}	
			}
			,where:{
				"reqId":window.localStorage.id
				,"reqParam":{
					"com_id":res[4]
				}
			}
			,cols: [[
				{field:'ath_id', width:120, title: '运动员编号'}
				,{field:'ath_name', width:120, title: '运动员'}
				,{field:'judge1',width:70,title:'裁判1'}
				,{field:'judge2',width:70,title:'裁判2'}
				,{field:'judge3',width:70,title:'裁判3'}
				,{field:'judge4',width:70,title:'裁判4'}
				,{field:'D',width:60,title:'D'}
				,{field:'P',width:60,title:'P'}
			]]
			,page: false
		}};
		
	
		layui.use(['table','jquery'], function(){
			var table = layui.table
				,layer = layui.layer
				,form = layui.form;
			
			//init the table
			table.render(param_gameType3(result));
			table.render(param_scoring3(result));

			//获取radio行的数据
			table.on("radio(gameType3)",function(data){
				console.log(data.data)
				result[4] = data.data.com_id;
				console.log(result[4]);
				table.render(param_scoring3(result));
					
			});
			
		});
		
		
		
		
		//////////////////////////////////////////////////////////////////////////////////////

        //总裁判通过/////////////////////////////////////////////////////////////////////////////////
        layui.use(['layer', 'table','jquery'], function () {
            var $ = layui.$
                , table = layui.table
                , layer = layui.layer;
            $(document).on('click', '#passed_btn', function () {
                console.log("123456");
                //监听通过按钮
                $.ajax({
                    type: "POST"
                    , url: "http://localhost:8080/ReviewScores"
                    , async: true
                    , data: JSON.stringify({
                        "reqId": window.localStorage.id
                        , "reqParam": {
                            "com_id": result[4]
                            , "pass": true
                        }
                    })
                    , dataType: "json"
                    , success: function (res) {
                        layer.msg("give mark success!");
                    }
                    , error: function (err) {
                        console.log(this.data);
                        console.log(err);
                    }
                });

                table.render(param_gameType3(result));
                table.render(param_scoring3(result));
                layer.msg("通过");
            });
        });

        ////////////////////////////////////////////////////////////////////////////////////

        //总裁判未通过/////////////////////////////////////////////////////////////////////////////////
        layui.use(['layer', 'table', 'jquery'], function () {
            var $ = layui.$
                , table = layui.table
                , layer = layui.layer;
            $(document).on('click', '#passed_btn', function () {
                console.log("qqqqqqq");
                //监听未通过按钮
                $.ajax({
                    type: "POST"
                    , url: "http://localhost:8080/ReviewScores"
                    , async: true
                    , data: JSON.stringify({
                        "reqId": window.localStorage.id
                        , "reqParam": {
                            "com_id": result[4]
                            , "pass": true
                        }
                    })
                    , dataType: "json"
                    , success: function (res) {
                        layer.msg("give mark success!");
                    }
                    , error: function (err) {
                        console.log(this.data);
                        console.log(err);
                    }
                });

                table.render(param_gameType3(result));
                table.render(param_scoring3(result));
            });
        });

        ////////////////////////////////////////////////////////////////////////////////////

        //运动员排名
        var url_search_all_ath_grade = "http://localhost:8080/GetAthleteResult";
        var field_id = "ath_id"
            , field_ath_name = "ath_name"
            , field_team_name = "team_name"
            , field_ath_age = "age"
            , field_ath_sex = "sex"
            , field_grade = "result";
        var param_ath_grade_all = {
            elem: '#ath_grade_all'
            , url: url_search_all_ath_grade
            , title: '运动员排名'
            , toolbar: true
            , contentType: 'application/json'
            , method: "POST"
            , where: { "reqId": window.localStorage.id }
            , deal: function (res) {
                return { code: 0, msg: "", count: 1000, data: res.resData }
            }
            , cols: [[
                { field: field_id, width: 100, title: 'ID', unresize: true, sort: true }
                , { field: field_ath_name, width: 150, title: '名称' }
                , { field: field_ath_age, width: 100, title: '年龄', sort: true }
                , { field: field_ath_sex, width: 100, title: '性别', sort: true }
                , { field: field_team_name, width: 150, title: '代表队' }
                , { field: field_grade, width: 150, title: '成绩', sort: true }
            ]]
        }

        layui.use('table', function () {
            var table = layui.table;
            table.render(param_ath_grade_all);
        })
        

	</script>

</body>
</html>